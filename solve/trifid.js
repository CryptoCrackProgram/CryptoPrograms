var cipher,uInt8Array,totalWorkers,workerNumber,numSols,keyword,isRunning,keyTrials,alphabet,period,solutions=[];function decipherTrifid(){"function"===typeof importScripts&&(importScripts("../support/decipherLib.js"),importScripts("../support/cryptoPrograms.js"));keyTrials=0;initSolution();alphabet=englishAlph+"#";"undefined"!==typeof keyword&&(0<keyword.length?solveWithKeyword(keyword):solveTrifid());!1===isRunning&&self.postMessage({cmd:"STOP",msg:""})}
function solveTrifid(){var a,d,e,g,b=[];var h=[];var c=[];var l=alphabet.length;isRunning=!0;for(e=0;1E3>e;e+=1)if(isRunning){h=randomiseAlphabet(l,alphabet).split("");for(a=0;a<h.length;a+=1)c[a]=h[a],b[a]=h[a];a=decrypt(c.join(""));var k=getTetraScore(a);keyTrials+=1;solutions[numSols-1]<k&&(solutions[numSols-1]=k,solutions.sort(function(m,n){return n-m}),self.postMessage({cmd:"reslt",key:c.join(""),score:k,text:a}));for(g=15;2<g;--g){h=0;do{for(a=d=0;a<b.length;a+=1)c[a]=b[a];var f=Math.floor(Math.random()*
l);a=Math.floor(Math.random()*l);var p=c[f];c[f]=c[a];c[a]=p;a=decrypt(c.join(""));f=getTetraScore(a);f>d&&(d=f,solutions[numSols-1]<d&&(solutions[numSols-1]=f,solutions.sort(function(m,n){return n-m}),self.postMessage({cmd:"reslt",key:c.join(""),score:f,text:a})));keyTrials+=1;a=f-k;d=0;0<a?d=1:(a=Math.pow(Math.E,a/g),p=(1E3*Math.random()+1)/1E3,a>p&&(d=1));if(1===d){b=c.slice();for(a=0;a<c.length;a+=1)b[a]=c[a];k=f}h+=1}while(1E3>h&&isRunning)}}isRunning=!1}
function decrypt(a){var d,e,g,b=[];var h=cipher.length;var c=g=0;var l="";for(d=0;d<h;d+=period){var k=period;d+period>h&&(k=h-d);for(e=0;e<k;e+=1){var f=a.indexOf(cipher.charAt(c));c+=1;b[g]=Math.floor(f/9);b[g+1]=Math.floor(f%9/3);b[g+2]=f%3;g+=3}for(e=0;e<k;e+=1)f=9*b[e]+3*b[e+k]+b[e+2*k],l="#"!==a.charAt(f)?l+a.charAt(f):l+"z";g=0}return l.toLowerCase()}
function solveWithKeyword(a){var d,e;var g=a;for(d=0;2>d;d+=1){var b=e=getKeyedAlphabet(alphabet,g);for(e=0;26>e;e+=1){var h=decrypt(b);var c=getTetraScore(h);solutions[numSols-1]<c&&(g=b,solutions[numSols-1]=c,solutions.sort(function(l,k){return k-l}),self.postMessage({cmd:"reslt",key:g,score:c,text:h}));b=b[b.length-1]+b.substring(0,b.length-1)}a+="#"}isRunning=!1}
self.addEventListener("message",function(a){a=a.data;cipher=a.cipher;uInt8Array=a.uInt8Array;totalWorkers=a.totalWorkers;workerNumber=a.workerNumber;numSols=a.numSols;keyword=a.keyword;period=a.period;decipherTrifid()},!1);