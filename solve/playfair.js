var plain,solutions=[],cipher,keyword,numSols,uInt8Array,workerNumber,totalWorkers,alphabet,routes,isRunning;function decipherPlayfair(){"function"===typeof importScripts&&(importScripts("../support/decipherLib.js"),importScripts("../support/cryptoPrograms.js"));initSolution();"undefined"!==typeof keyword&&(0<keyword.length?solveWithKeyword():solvePlayfair());!1===isRunning&&self.postMessage({cmd:"STOP",msg:""})}
function solvePlayfair(){var b,a,h,f=[];var e=[];var l=[],c=[];var m=alphabet.length;var d=Math.sqrt(alphabet.length);var p=0;isRunning=!0;var r=0;a:for(;1E3>r;r+=1)if(isRunning){e=randomiseAlphabet(m,alphabet).split("");for(b=0;b<e.length;b+=1)c[b]=e[b],l[b]=e[b];plain=decrypt(c,d);b=5===d?getTetraScore(plain):getTetraScore(plain.replace(/[^a-z]/g,""));b>p&&(p=b);solutions[numSols-1]<b&&(solutions[numSols-1]=b,solutions.sort(function(t,u){return u-t}),self.postMessage({cmd:"reslt",key:c.join(""),
score:b,text:plain}));for(h=15;0<h;--h)if(isRunning){var n=e=0;do{var g=Math.floor(100*Math.random());switch(g){case 1:case 2:case 8:for(a=0;a<m;a+=1)c[a]=l[routes[g][a]];break;case 3:for(a=0;a<m;a+=1)c[a]=l[a];g=Math.floor(Math.random()*d)*d;var k=Math.floor(Math.random()*d)*d;for(a=0;a<d;a+=1)f[a]=c[g+a];for(a=0;a<d;a+=1)c[g+a]=c[k+a];for(a=0;a<d;a+=1)c[k+a]=f[a];break;case 4:for(a=0;a<m;a+=1)c[a]=l[a];g=Math.floor(Math.random()*d);k=Math.floor(Math.random()*d);for(a=0;a<d;a+=1)f[a]=c[g+a*d];for(a=
0;a<d;a+=1)c[g+a*d]=c[k+a*d];for(a=0;a<d;a+=1)c[k+a*d]=f[a];break;default:for(a=0;a<m;a+=1)c[a]=l[a];a=Math.floor(Math.random()*m);g=Math.floor(Math.random()*m);k=c[a];c[a]=c[g];c[g]=k}plain=decrypt(c,d);a=5===d?getTetraScore(plain):getTetraScore(plain.replace(/[^a-z]/g,""));a>n&&(n=a,n>p&&(p=n));solutions[numSols-1]<a&&(solutions[numSols-1]=a,solutions.sort(function(t,u){return u-t}),self.postMessage({cmd:"reslt",key:c.join(""),score:a,text:plain}));k=a-b;g=0;if(0<k)g=1;else{k=Math.pow(Math.E,k/
h);var q=(1E3*Math.random()+1)/1E3;k>q&&(g=1)}if(1===g){for(b=0;b<c.length;b+=1)l[b]=c[b];b=a}e+=1}while(1E3>e&&isRunning)}else break a}else break a;isRunning=!1}
function decrypt(b,a){var h,f,e,l,c=ord("A"),m=alphabet.length,d="";for(l=f=h=0;l<cipher.length;l+=2){for(e=0;e<m;e+=1)if(cipher[l]===b[e]){h=e;break}for(e=0;e<m;e+=1)if(cipher[l+1]===b[e]){f=e;break}e=Math.floor(h/a);var p=Math.floor(f/a);h%=a;f%=a;var r=0;if(e===p){r=1;var n=h-1;var g=f-1;0>n&&(n=a-1);0>g&&(g=a-1);var k=e;var q=p}h===f&&(r=1,k=e-1,q=p-1,0>k&&(k=a-1),0>q&&(q=a-1),n=h,g=f);0===r&&(k=e,n=f,q=p,g=h);h=k*a+n;f=q*a+g;d=b[h]>=c?d+(b[h]+32):d+b[h];d=b[f]>=c?d+(b[f]+32):d+b[f]}return d.toLowerCase()}
function solveWithKeyword(){var b,a;var h=alphabet.length;var f=Math.sqrt(h);isRunning=!0;if(5===f)var e=getKeyedAlphabet(alphabet,keyword);else{e=getKeyedAlphabet(englishAlph36,keyword);var l=getACAKeyedAlphabet(alphabet,keyword)}for(a=0;a<routes.length;a+=1){var c="";for(b=0;b<h;b+=1)c+=e[routes[a][b]];plain=decrypt(c,f);b=5===f?getTetraScore(plain):getTetraScore(plain.replace(/[^a-z]/g,""));solutions[numSols-1]<b&&(solutions[numSols-1]=b,solutions.sort(function(m,d){return d-m}),self.postMessage({cmd:"reslt",
key:c,score:b,text:plain}));if(6===f){c="";for(b=0;b<alphabet.length;b+=1)c+=l[routes[a][b]];plain=decrypt(c,f);b=getTetraScore(plain.replace(/[^a-z]/g,""));solutions[numSols-1]<b&&(solutions[numSols-1]=b,solutions.sort(function(m,d){return d-m}),self.postMessage({cmd:"reslt",key:c,score:b,text:plain}))}}isRunning=!1}
self.addEventListener("message",function(b){b=b.data;cipher=b.cipher;uInt8Array=b.uInt8Array;totalWorkers=b.totalWorkers;workerNumber=b.workerNumber;numSols=b.numSols;alphabet=b.alphabet;keyword=b.keyword;routes=b.routes;decipherPlayfair()},!1);