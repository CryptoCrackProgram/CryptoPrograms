var plain,solutions=[],cipher,primer,keyword,numSols,uInt8Array,workerNumber,totalWorkers,alphabet,isRunning,runningKey=[];function decipherGromark(){"function"===typeof importScripts&&(importScripts("../support/decipherLib.js"),importScripts("../support/cryptoPrograms.js"));initSolution();createRunningKey();alphabet=englishAlph;"undefined"!==typeof keyword&&(0<keyword.length?solveWithKeyword():solveGromark());!1===isRunning&&self.postMessage({cmd:"STOP",msg:""})}
function solveGromark(){var b,a,d;var c=[];var k=[],e=[];var f=alphabet.length;var g=0;isRunning=!0;var h=0;a:for(;1E3>h;h+=1)if(isRunning){c=randomiseAlphabet(f,alphabet).split("");for(a=0;a<c.length;a+=1)e[a]=c[a],k[a]=c[a];plain=decrypt(e.join(""));a=getTetraScore(plain);a>g&&(g=a);solutions[numSols-1]<a&&(solutions[numSols-1]=a,solutions.sort(function(p,q){return q-p}),self.postMessage({cmd:"reslt",key:e.join(""),score:a,text:plain}));for(d=15;1<d;--d)if(isRunning){var n=c=0;do{for(b=0;b<k.length;b+=
1)e[b]=k[b];b=Math.floor(Math.random()*f);var l=Math.floor(Math.random()*f);var m=e[b];e[b]=e[l];e[l]=m;plain=decrypt(e.join(""));b=getTetraScore(plain);b>n&&(n=b,n>g&&(g=n));solutions[numSols-1]<b&&(solutions[numSols-1]=b,solutions.sort(function(p,q){return q-p}),self.postMessage({cmd:"reslt",key:e.join(""),score:b,text:plain}));m=b-a;l=0;if(0<m)l=1;else{m=Math.pow(Math.E,m/d);var r=(1E3*Math.random()+1)/1E3;m>r&&(l=1)}if(1===l){for(a=0;a<e.length;a+=1)k[a]=e[a];a=b}c+=1}while(1E3>c&&isRunning)}else break a}else break a;
isRunning=!1}function decrypt(b){var a;var d=alphabet.length;plain="";for(a=0;a<cipher.length;a+=1){var c=b.indexOf(cipher.charAt(a))-runningKey[a];0>c&&(c+=d);c=alphabet.charAt(c);plain+=c}return plain.toLowerCase()}
function solveWithKeyword(){var b=getKeyedAlphabet(alphabet,keyword);var a=rearrangeAlphabet(b);plain=decrypt(a);a=getTetraScore(plain);solutions[numSols-1]<a&&(solutions[numSols-1]=a,solutions.sort(function(d,c){return c-d}),self.postMessage({cmd:"reslt",key:b,score:a,text:plain}));isRunning=!1}
function rearrangeAlphabet(b){var a,d;var c=ord("A");var k=ord("Z"),e=[],f=[];var g=0;var h=keyword.length;for(a=0;a<h;a+=1)f[a]="";for(a=c;a<=k;a+=1)for(c=chr(a),d=keyword.indexOf(c);0<=d&&g<h;)e[d]=g,g+=1,d=keyword.indexOf(c,d+1);for(a=d=0;a<b.length;a+=1)f[e[a%h]]+=b.charAt(d),d+=1;return f.join("")}function createRunningKey(){var b,a=0;for(b=0;b<primer.length;b+=1)runningKey[b]=parseInt(primer.charAt(b));for(;b<cipher.length;)runningKey[b]=(runningKey[a]+runningKey[a+1])%10,a+=1,b+=1}
self.addEventListener("message",function(b){b=b.data;cipher=b.cipher;uInt8Array=b.uInt8Array;totalWorkers=b.totalWorkers;workerNumber=b.workerNumber;numSols=b.numSols;primer=b.primer;keyword=b.keyword;decipherGromark()},!1);