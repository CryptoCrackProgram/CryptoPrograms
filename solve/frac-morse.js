var plain,solutions=[],cipher,key,numSols,uInt8Array,workerNumber,totalWorkers,isRunning,table=[];function decipherFrac(){"function"===typeof importScripts&&(importScripts("../support/decipherLib.js"),importScripts("../support/cryptoPrograms.js"),importScripts("../support/morse.js"));initSolution();readTable();alphabet=englishAlph;"undefined"!==typeof key&&(0<key.length?solveWithKeyword():solveFrac());!1===isRunning&&self.postMessage({cmd:"STOP",msg:""})}
function solveFrac(){var b,c,a,f,d,h,e=[],m=[];var n=alphabet.length;var l=8;var k=0;isRunning=!0;for(d=0;5E4>d;d+=1)if(1===Math.floor(100*Math.random())&&(l=Math.floor(5*Math.random())+8),isRunning){if(0===d%200)for(e=0===e.length?randomAlphabet(l).split(""):getKeyedAlphabet(alphabet,e).split(""),a=0;a<n;a+=1)m[a]=e[a];for(f=h=0;50>f;f+=1){for(b=0;b<l-1;b+=1)for(c=0;c<n;c+=1){for(a=0;a<n;a+=1)e[a]=m[a];do{a=Math.floor(Math.random()*l);var g=Math.floor(Math.random()*l)}while(a===g);var r=e[a];e[a]=
e[g];e[g]=r;e=swapKeyedAlphabet(e,l,c,b);plain=decrypt(e.join(""));g=getTetraScore(plain.replace(/[^a-z]/g,""));if(g>h)for(h=g,a=0;a<e.length;a+=1)m[a]=e[a];if(g>k){k=g;for(a=0;a<n;a+=1);solutions[numSols-1]<k&&(solutions[numSols-1]=k,solutions.sort(function(p,q){return q-p}),self.postMessage({cmd:"reslt",key:e.join(""),score:g,text:plain}))}}for(a=0;a<e.length;a+=1)e[a]=m[a];for(c=0;500>c;c+=1){e=mixKeyword(e,l);plain=decrypt(e.join(""));g=getTetraScore(plain.replace(/[^a-z]/g,""));if(g>h)for(h=
g,a=0;a<e.length;a+=1)m[a]=e[a];if(g>k){k=g;for(a=0;a<n;a+=1);solutions[numSols-1]<k&&(solutions[numSols-1]=k,solutions.sort(function(p,q){return q-p}),self.postMessage({cmd:"reslt",key:e.join(""),score:g,text:plain}))}}}}isRunning=!1}function swapKeyedAlphabet(b,c,a,f){var d=alphabet;b=b.splice(0,c);b[f]=alphabet[a];a=b[0];d=d.replace(b[0],"");for(c=1;c<b.length;c+=1)-1===a.indexOf(b[c])&&(a+=b[c],d=d.replace(b[c],""));return(a+d).split("")}
function mixKeyword(b,c){var a=alphabet;var f=alphabet.length-c;b=b.splice(0,c);do{var d=Math.floor(Math.random()*f)+c;var h=Math.floor(Math.random()*c)}while(0<=b.indexOf(a.charAt(d))||d===h);b[h]=a.charAt(d);for(d=0;d<c;d+=1)a=a.replace(b[d],"");return b.concat(a.split(""))}
function randomAlphabet(b){var c;var a=alphabet.length;var f=alphabet;var d=Math.floor(Math.random()*a);var h=f.charAt(d);f=f.substr(0,d)+f.substr(d+1);for(c=1;c<b;c+=1){d=Math.floor(Math.random()*(a-c));var e=f.charAt(d);h+=e;f=f.substr(0,d)+f.substr(d+1)}return h+f}function decrypt(b){var c;var a="";for(c=0;c<cipher.length;c+=1){var f=b.indexOf(cipher.charAt(c));a+=table[f]}return convertMorseToAnyPlain(a)}
function readTable(){table="... ..- ..x .-. .-- .-x .x. .x- .xx -.. -.- -.x --. --- --x -x. -x- -xx x.. x.- x.x x-. x-- x-x xx. xx-".split(" ")}
function solveWithKeyword(){var b;keyedAlph=getKeyedAlphabet(alphabet,key);for(b=0;26>b;b+=1){plain=decrypt(keyedAlph);if(0<plain.length){var c=getTetraScore(plain.replace(/[^a-z]/g,""));solutions[numSols-1]<c&&(solutions[numSols-1]=c,solutions.sort(function(a,f){return f-a}),self.postMessage({cmd:"reslt",key:keyedAlph,score:c,text:plain}))}keyedAlph=keyedAlph.substr(1)+keyedAlph.substr(0,1)}isRunning=!1}
self.addEventListener("message",function(b){b=b.data;cipher=b.cipher;uInt8Array=b.uInt8Array;totalWorkers=b.totalWorkers;workerNumber=b.workerNumber;numSols=b.numSols;key=b.key;decipherFrac()},!1);