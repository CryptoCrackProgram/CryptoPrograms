var plain,period,solutions=[],cipher,cType,keyword,minPeriod,maxPeriod,numSols,uInt8Array,key=[],isRunning;function decipherSlidefair(){"function"===typeof importScripts&&(importScripts("../support/decipherLib.js"),importScripts("../support/cryptoPrograms.js"));initSolution();"undefined"!==typeof keyword&&(0<keyword.length?solveWithKeyword():solveSlidefair());!1===isRunning&&self.postMessage({cmd:"STOP",msg:""})}
function solveSlidefair(){var a,b,c,d,e,f=[],g=ord("A");var h=cipher.length;isRunning=!0;for(period=minPeriod;period<=maxPeriod;period+=1)for(cType=0;3>cType;cType+=1)for(key=[],a=e=0;26>a;a+=1)for(f[0]=a,b=0;26>b;b+=1){f[1]=b;for(c=d=0;c<h-4;c+=2*period)d+=getTestKeyScore(f,2,c);if(d>e&&(e=d,key[0]=chr(a+g),key[1]=chr(b+g),getRemainingKey(period),plain=decipher(key),c=getTetraScore(plain),solutions[numSols-1]<c)){solutions[numSols-1]=c;solutions.sort(function(k,l){return l-k});switch(cType){case 0:d=
key.join("")+" (Vigenere)";break;case 1:d=key.join("")+" (Beaufort)";break;default:d=key.join("")+" (Variant)"}self.postMessage({cmd:"reslt",key:d,score:c,text:plain.toLowerCase()})}}isRunning=!1}
function getTestKeyScore(a,b,c){var d,e=0,f=ord("A");var g=0;var h="";switch(cType){case 0:for(d=0;d<b;d+=1)h+=decryptVig(ord(cipher[g+c])-f,ord(cipher[g+c+1])-f,a[d]),g+=2;e+=getSingleTetraScore(h);break;case 1:for(d=0;d<b;d+=1)h+=decryptBeau(ord(cipher[g+c])-f,ord(cipher[g+c+1])-f,a[d]),g+=2;e+=getSingleTetraScore(h);break;case 2:for(d=0;d<b;d+=1)h+=decryptVar(ord(cipher[g+c])-f,ord(cipher[g+c+1])-f,a[d]),g+=2;e+=getSingleTetraScore(h)}return e}
function getRemainingKey(a){var b,c,d,e=[],f=ord("A");for(d=1;d<a-1;d+=1){var g=0;key[d+1]="A";e[0]=ord(key[d])-f;for(c=0;26>c;c+=1){e[1]=c;var h=0;for(b=2*d;b<cipher.length-4;b+=2*a)h+=getTestKeyScore(e,2,b);h>g&&(g=h,key[d+1]=chr(c+f))}}}
function decipher(a){var b,c=ord("A"),d=[];var e=a.length;for(b=0;b<e;b+=1)d[b]=ord(a[b])-c;var f="";a=0;switch(cType){case 0:for(b=0;b<cipher.length;b+=2)f+=decryptVig(ord(cipher[b])-c,ord(cipher[b+1])-c,d[a]),a+=1,a===e&&(a=0);break;case 1:for(b=0;b<cipher.length;b+=2)f+=decryptBeau(ord(cipher[b])-c,ord(cipher[b+1])-c,d[a]),a+=1,a===e&&(a=0);break;case 2:for(b=0;b<cipher.length;b+=2)f+=decryptVar(ord(cipher[b])-c,ord(cipher[b+1])-c,d[a]),a+=1,a===e&&(a=0)}return f}
function decryptVig(a,b,c){var d=ord("a");if((b-a+26)%26===c){var e=a-1;0>e&&(e+=26);a=b-1;0>a&&(a+=26)}else e=b-c,0>e&&(e+=26),a=(a+c)%26;return chr(e+d)+chr(a+d)}function decryptBeau(a,b,c){var d=ord("a");var e=c-b;0>e&&(e+=26);a===e?(e=a-1,0>e&&(e+=26),a=b+1,25<a&&(a-=26)):(a=c-a,0>a&&(a+=26));return chr(e+d)+chr(a+d)}function decryptVar(a,b,c){var d=ord("a");(a-b+26)%26===c?(c=a-1,0>c&&(c+=26),a=b-1,0>a&&(a+=26)):(a-=c,0>a&&(a+=26),c=(b+c)%26);return chr(c+d)+chr(a+d)}
function solveWithKeyword(){var a=0;period=keyword.length;for(cType=0;3>cType;cType+=1){plain=decipher(keyword);var b=getTetraScore(plain);switch(cType){case 0:key=keyword+" (Vigenere)";break;case 1:key=keyword+" (Beaufort)";break;default:key=keyword+" (Variant)"}b>a&&(a=b,self.postMessage({cmd:"reslt",key:key,score:b,text:plain.toLowerCase()}))}isRunning=!1}
self.addEventListener("message",function(a){a=a.data;cipher=a.cipher;uInt8Array=a.uInt8Array;numSols=a.numSols;keyword=a.keyword;minPeriod=a.minPeriod;maxPeriod=a.maxPeriod;decipherSlidefair()},!1);