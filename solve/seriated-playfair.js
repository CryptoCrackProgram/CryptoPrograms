var period,solutions=[],cipher,keyword,numSols,uInt8Array,alphabet,routes,isRunning;function decipherSerPlayfair(){"function"===typeof importScripts&&(importScripts("../support/decipherLib.js"),importScripts("../support/cryptoPrograms.js"));initSolution();"undefined"!==typeof keyword&&(0<keyword.length?solveWithKeyword():solveSerPlayfair());!1===isRunning&&self.postMessage({cmd:"STOP",msg:""})}
function solveSerPlayfair(){var b,a,n,p,m=[];var h=[];var k=[],c=[];var f=alphabet.length;var d=Math.sqrt(f);var l=0;isRunning=!0;var t=0;a:for(;1E3>t;t+=1)if(isRunning){h=randomiseAlphabet(f,alphabet).split("");for(b=0;b<h.length;b+=1)c[b]=h[b],k[b]=h[b];var e=decrypt(c,d);b=5===d?getTetraScore(e):getTetraScore(e.replace(/[^a-z]/g,""));l+=1;b>n&&(n=b);solutions[numSols-1]<b&&(solutions[numSols-1]=b,solutions.sort(function(r,v){return v-r}),self.postMessage({cmd:"reslt",key:c.join(""),score:b,trials:l,
text:e}));for(p=15;0<p;--p)if(isRunning){var q=h=0;do{e=Math.floor(50*Math.random());switch(e){case 1:case 2:case 8:for(a=0;a<f;a+=1)c[a]=k[routes[e][a]];break;case 3:for(a=0;a<f;a+=1)c[a]=k[a];e=Math.floor(Math.random()*d)*d;var g=Math.floor(Math.random()*d)*d;for(a=0;a<d;a+=1)m[a]=c[e+a];for(a=0;a<d;a+=1)c[e+a]=c[g+a];for(a=0;a<d;a+=1)c[g+a]=m[a];break;case 4:for(a=0;a<f;a+=1)c[a]=k[a];e=Math.floor(Math.random()*d);g=Math.floor(Math.random()*d);for(a=0;a<d;a+=1)m[a]=c[e+a*d];for(a=0;a<d;a+=1)c[e+
a*d]=c[g+a*d];for(a=0;a<d;a+=1)c[g+a*d]=m[a];break;default:for(a=0;a<f;a+=1)c[a]=k[a];a=Math.floor(Math.random()*f);e=Math.floor(Math.random()*f);g=c[a];c[a]=c[e];c[e]=g}e=decrypt(c,d);a=5===d?getTetraScore(e):getTetraScore(e.replace(/[^a-z]/g,""));a>q&&(q=a,q>n&&(n=q));l+=1;solutions[numSols-1]<a&&(solutions[numSols-1]=a,solutions.sort(function(r,v){return v-r}),self.postMessage({cmd:"reslt",key:c.join(""),score:a,trials:l,text:e}));l+=1;g=a-b;e=0;if(0<g)e=1;else{g=Math.pow(Math.E,g/p);var u=(1E3*
Math.random()+1)/1E3;g>u&&(e=1)}if(1===e){for(b=0;b<c.length;b+=1)k[b]=c[b];b=a}h+=1}while(5E3>h&&isRunning)}else break a}else break a;isRunning=!1}
function decrypt(b,a){var n,p,m,h="";for(n=m=0;n<cipher.length;n+=2*period){var k=n<=cipher.length-2*period?period:cipher.length%(2*period)/2;var c="";for(p=0;p<k;p+=1){var f=cipher[m];var d=cipher[m+k];f=b.indexOf(f);var l=b.indexOf(d);d=Math.floor(f/a);var t=f%a;f=Math.floor(l/a);l%=a;var e=0;if(d===f){e=1;var q=t-1;var g=l-1;0>q&&(q=a-1);0>g&&(g=a-1);var u=d;var r=f}t===l&&(e=1,u=d-1,r=f-1,0>u&&(u=a-1),0>r&&(r=a-1),q=t,g=l);0===e&&(u=d,q=l,r=f,g=t);f=u*a+q;l=r*a+g;h+=b[f];c+=b[l];m+=1}h+=c;m+=
k}return h.toLowerCase()}
function solveWithKeyword(){var b,a;var n=alphabet.length;var p=Math.sqrt(n);isRunning=!0;if(5===p)var m=getKeyedAlphabet(alphabet,keyword);else m=getKeyedAlphabet(alphabet,keyword),originalACAKeyedAlphabet=getACAKeyedAlphabet(alphabet,keyword);for(a=0;a<routes.length;a+=1){var h="";for(b=0;b<n;b+=1)h+=m[routes[a][b]];var k=decrypt(h,p);b=5===p?getTetraScore(k):getTetraScore(k.replace(/[^a-z]/g,""));solutions[numSols-1]<b&&(solutions[numSols-1]=b,solutions.sort(function(c,f){return f-c}),self.postMessage({cmd:"reslt",
key:h,score:b,text:k}))}isRunning=!1}self.addEventListener("message",function(b){b=b.data;cipher=b.cipher;uInt8Array=b.uInt8Array;numSols=b.numSols;alphabet=b.alphabet;keyword=b.keyword;period=b.period;routes=b.routes;decipherSerPlayfair()},!1);