var cipher,uInt8Array,workerNumber,numSols,keyword,isRunning,keyLength,solutions=[],cipherGrid=[],plainText,plainText2;function decipherNihilTransp(){"function"===typeof importScripts&&(importScripts("../support/decipherLib.js"),importScripts("../support/cryptoPrograms.js"));initSolution();"undefined"!==typeof keyword&&(0<keyword.length?solveWithKeyword(keyword):solveNihilTransp());!1===isRunning&&self.postMessage({cmd:"STOP",msg:""})}
function solveNihilTransp(){var b,a,d,f,g,m=[];var n=[];var c=[];keyLength=Math.sqrt(cipher.length);var h=0;c=randomiseNumbers(keyLength);cipherGrid=[];for(b=0;b<keyLength;b+=1)cipherGrid[b]=[];isRunning=!0;for(d=1;200>=d;d+=199)if(10>=keyLength){if(isRunning){c=[];for(b=0;b<keyLength;b+=1)c[b]=b;d=permutator(c);for(b=0;b<d.length;b+=1)if(isRunning){h+=1;for(a=0;a<keyLength;a+=1)c[a]=d[b][a];fillGrid();decrypt(c);a=getTetraScore(plainText.replace(/[^a-z]/g,""));if(solutions[numSols-1]<a){solutions[numSols-
1]=a;solutions.sort(function(k,l){return l-k});var e=10>=keyLength?c.join(""):convertColumnToKey(c);self.postMessage({cmd:"reslt",key:e,score:a,trials:h,text:plainText})}a=getTetraScore(plainText2.replace(/[^a-z]/g,""));solutions[numSols-1]<a&&(solutions[numSols-1]=a,solutions.sort(function(k,l){return l-k}),e=10>=keyLength?c.join(""):convertColumnToKey(c),self.postMessage({cmd:"reslt",key:e,score:a,trials:h,text:plainText2}));self.postMessage({cmd:"progress",worker:workerNumber,trials:h})}else break}else break;
d=200}else for(f=0;1E3>f;f+=1)if(isRunning){n=randomiseNumbers(keyLength);for(b=0;b<n.length;b+=1)c[b]=n[b],m[b]=n[b];fillGrid();decrypt(c);n=getTetraScore(plainText.replace(/[^a-z]/g,""));h+=1;solutions[numSols-1]<n&&(solutions[numSols-1]=n,solutions.sort(function(k,l){return l-k}),e=10>=keyLength?c.join(""):convertColumnToKey(c),self.postMessage({cmd:"reslt",key:e,score:n,trials:h,text:plainText}));a=getTetraScore(plainText2.replace(/[^a-z]/g,""));solutions[numSols-1]<a&&(solutions[numSols-1]=a,
solutions.sort(function(k,l){return l-k}),e=10>=keyLength?c.join(""):convertColumnToKey(c),self.postMessage({cmd:"reslt",key:c.join(""),score:a,trials:h,text:plainText2}));for(g=15;2<g;--g){b=0;do{for(a=0;a<keyLength;a+=1)c[a]=m[a];a=Math.floor(Math.random()*keyLength);e=Math.floor(Math.random()*keyLength);var p=c[a];c[a]=c[e];c[e]=p;fillGrid();decrypt(c);a=getTetraScore(plainText.replace(/[^a-z]/g,""));solutions[numSols-1]<a&&(solutions[numSols-1]=a,solutions.sort(function(k,l){return l-k}),e=10>=
keyLength?c.join(""):convertColumnToKey(c),self.postMessage({cmd:"reslt",key:e,score:a,trials:h,text:plainText}));a=getTetraScore(plainText2.replace(/[^a-z]/g,""));solutions[numSols-1]<a&&(solutions[numSols-1]=a,solutions.sort(function(k,l){return l-k}),e=10>=keyLength?c.join(""):convertColumnToKey(c),self.postMessage({cmd:"reslt",key:e,score:a,trials:h,text:plainText2}));h+=1;p=a-n;e=0;if(0<p)e=1;else{p=Math.pow(Math.E,p/g);var q=(1E3*Math.random()+1)/1E3;p>q&&(e=1)}1===e&&(m=c.slice(),n=a);b+=1}while(b<
d&&isRunning)}}isRunning=!1;self.postMessage({cmd:"progress",worker:workerNumber,trials:h})}function fillGrid(){var b,a,d=0;for(b=0;b<keyLength;b+=1)for(a=0;a<keyLength;a+=1)cipherGrid[b][a]=cipher[d],d+=1}function decrypt(b){var a,d,f=[],g=[];for(a=0;a<keyLength;a+=1)for(d=0;d<keyLength;d+=1){var m=a*keyLength+d;f[m]=cipherGrid[b[d]][b[a]];g[m]=cipherGrid[b[a]][b[d]]}plainText=f.join("").toLowerCase();plainText2=g.join("").toLowerCase()}
function solveWithKeyword(b){var a,d=[];keyLength=b.length;var f=getColumnOrder(b);for(a=0;a<keyLength;a+=1)d[a]=f[a],cipherGrid[a]=[];fillGrid();decrypt(d);a=getTetraScore(plainText.replace(/[^a-z]/g,""));solutions[numSols-1]<a&&(solutions[numSols-1]=a,solutions.sort(function(g,m){return m-g}),self.postMessage({cmd:"reslt",key:b,score:a,text:plainText}));a=getTetraScore(plainText2.replace(/[^a-z]/g,""));solutions[numSols-1]<a&&(solutions[numSols-1]=a,solutions.sort(function(g,m){return m-g}),self.postMessage({cmd:"reslt",
key:b,score:a,text:plainText2}));isRunning=!1}function getColumnOrder(b){var a,d=[],f=b.split("").sort().join("");for(a=0;a<b.length;a+=1){var g=f.indexOf(b[a]);d[a]=g;f=f.replace(f[g]," ")}return d.join("")}function convertColumnToKey(b){var a,d="",f=ord("A");for(a=0;a<b.length;a+=1)d+=chr(b[a]+f);return d}self.addEventListener("message",function(b){b=b.data;cipher=b.cipher;uInt8Array=b.uInt8Array;workerNumber=b.workerNumber;numSols=b.numSols;keyword=b.keyword;decipherNihilTransp()},!1);