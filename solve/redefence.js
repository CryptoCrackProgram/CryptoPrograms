var cipher,numSols,uInt8Array,workerNumber,totalWorkers,isRunning,minRails,maxRails,table=[],plain=[],solutions=[];function decipherRedefence(){"function"===typeof importScripts&&(importScripts("../support/decipherLib.js"),importScripts("../support/cryptoPrograms.js"));initSolution();solveRedefence();!1===isRunning&&self.postMessage({cmd:"STOP",msg:""})}
function solveRedefence(){var a,b,e,d,f,c=[],g=[];isRunning=!0;cipher=cipher.toLowerCase();for(d=minRails+workerNumber;d<=maxRails;d+=totalWorkers){var h=2*d-2;var k=1;initTable(h);for(a=c.length=0;a<h+1;a+=1)c[a]=0;for(a=0;a<d;a+=1)g[a]=a+1;var l=permutator(g);for(e=0;e<l.length;e+=1)for(f=1;f<=h;f+=1){for(a=1;a<=h;a+=1)c[a]=1;for(a=0;a<=d;a+=1)for(b=0;b<=cipher.length;b+=1)table[a][b]=0;a=f;a>d&&(a-=2,k=-1);for(b=1;b<=cipher.length;b+=1)table[a][c[a]]=b,c[a]+=1,a+=k,a>d&&(a-=2,k=-1),1>a&&(a+=2,
k=1);decrypt(l[e])}}isRunning=!1}function permutator(a){function b(d,f){f=f||[];var c;for(c=0;c<d.length;c+=1){var g=d.splice(c,1);0===d.length&&e.push(f.concat(g));b(d.slice(),f.concat(g));d.splice(c,0,g[0])}return e}var e=[];return b(a)}
function decrypt(a){var b,e=1,d=[cipher.length+a.length];for(b=0;b<a.length;b+=1){var f=a[b];var c=1;var g=table[f][c];do d[e]=g,e+=1,c+=1,g=table[f][c];while(0!==g)}c=0;for(b=1;b<=cipher.length;b+=1)0<d[b]&&(plain[d[b]-1]=cipher[c],c+=1);b=getTetraScore(plain.join("").toLowerCase().replace(/[^a-z]/g,""));solutions[numSols-1]<b&&(solutions[numSols-1]=b,solutions.sort(function(h,k){return k-h}),self.postMessage({cmd:"reslt",key:"Rails:"+a.length+" Order:"+a.join(""),score:b,text:plain.join("")}))}
function initTable(a){var b,e;for(b=table.length=0;b<a+1;b+=1)for(table[b]=[],e=0;e<cipher.length+1;e+=1)table[b][e]=0}self.addEventListener("message",function(a){a=a.data;cipher=a.cipher;uInt8Array=a.uInt8Array;totalWorkers=a.totalWorkers;workerNumber=a.workerNumber;numSols=a.numSols;minRails=a.minRails;maxRails=a.maxRails;decipherRedefence()},!1);