var plain,solutions=[],cipher,keyword,numSols,uInt8Array,workerNumber,totalWorkers,isRunning,fixedSlide,slide=[],key=[];
function decipherPortax(){"function"===typeof importScripts&&(importScripts("../support/decipherLib.js"),importScripts("../support/cryptoPrograms.js"));initSolution();fixedSlide="ABCDEFGHIJKLMABCDEFGHIJKLM";slide[1]="NOPQRSTUVWXYZ";slide[2]="ACEGIKMOQSUWY";slide[3]="BDFHJLNPRTVXZ";"undefined"!==typeof keyword&&(0<keyword.length?solveWithKeyword():solvePortax());!1===isRunning&&self.postMessage({cmd:"STOP",msg:""})}
function solvePortax(){var a,b,e,d,c,f,g,h=[],l=ord("A"),k=ord("Z"),p;var m=4+workerNumber;var q=cipher.length;isRunning=!0;for(g=m;20>=g;g+=totalWorkers){var r=0;for(m=l;m<=k;m+=1)for(h[0]=chr(m),a=l;a<=k;a+=1)for(h[1]=chr(a),b=l;b<=k;b+=1)for(h[2]=chr(b),e=l;e<=k;e+=1){h[3]=chr(e);for(d=f=0;d<q;d+=2*g){var n=cipher.substr(d,2*g);var t=Math.floor(n.length/2);if(3<t){var u=p="";for(c=0;4>c;c+=1){var v=convertToPlain(n[c],n[c+t],h[c]);p+=v[0];u+=v[1]}f+=getSingleTetraScore(p.toLowerCase());f+=getSingleTetraScore(u.toLowerCase())}}f>
r&&(r=f,key[0]=chr(m),key[1]=chr(a),key[2]=chr(b),key[3]=chr(e),getRemainingKey(g),keyword=key.join(""),plain=decrypt(keyword,g),f=getTetraScore(plain),self.postMessage({cmd:"reslt",key:keyword,score:f,text:plain.toLowerCase()}))}}isRunning=!1}
function getRemainingKey(a){var b,e,d,c,f,g,h=ord("A"),l=ord("Z"),k=[];var p=cipher.length;for(b=1;b<a-3;b+=1){k[0]=key[b];k[1]=key[b+1];k[2]=key[b+2];var m=0;key[b+3]="A";for(e=h;e<=l;e+=2){k[3]=chr(e);for(d=f=0;d<p;d+=2*a){var q=cipher.substr(d,2*a);var r=Math.floor(q.length/2);var n=g="";for(c=0;4>c;c+=1)if(c+b<r){var t=convertToPlain(q[c+b],q[c+b+r],k[c]);g+=t[0];n+=t[1]}4===g.length&&(f+=getSingleTetraScore(g.toLowerCase()),f+=getSingleTetraScore(n.toLowerCase()))}f>m&&(m=f,key[b+3]=chr(e))}}}
function decrypt(a,b){var e,d,c,f=[];for(e=c=0;e<cipher.length;e+=2*b){var g=cipher.substr(e,2*b);var h=Math.floor(g.length/2);for(d=0;d<h;d+=1){var l=convertToPlain(g[d],g[d+h],a[d]);f[d+c]=l[0];f[d+c+h]=l[1]}c+=2*h}return f.join("").toLowerCase()}
function convertToPlain(a,b,e){var d=ord("A");var c=[];e=13-Math.floor((ord(e)-d)/2);d=ord(b)-d;slide[0]=fixedSlide.substr(e,13);"N">a?(a=slide[0].indexOf(a),0===d%2?(b=slide[2].indexOf(b),a===b?(c[0]=slide[1][b],c[1]=slide[3][a]):(c[0]=slide[0][b],c[1]=slide[2][a])):(b=slide[3].indexOf(b),a===b?(c[0]=slide[1][a],c[1]=slide[2][a]):(c[0]=slide[0][b],c[1]=slide[3][a]))):(a=slide[1].indexOf(a),0===d%2?(b=slide[2].indexOf(b),a===b?(c[0]=slide[0][b],c[1]=slide[3][a]):(c[0]=slide[1][b],c[1]=slide[2][a])):
(b=slide[3].indexOf(b),a===b?(c[0]=slide[0][b],c[1]=slide[2][a]):(c[0]=slide[1][b],c[1]=slide[3][a])));return c}function solveWithKeyword(){isRunning=!0;plain=decrypt(keyword,keyword.length);var a=getTetraScore(plain);self.postMessage({cmd:"reslt",key:keyword,score:a,text:plain.toLowerCase()});isRunning=!1}
self.addEventListener("message",function(a){a=a.data;cipher=a.cipher;uInt8Array=a.uInt8Array;totalWorkers=a.totalWorkers;workerNumber=a.workerNumber;numSols=a.numSols;keyword=a.keyword;decipherPortax()},!1);