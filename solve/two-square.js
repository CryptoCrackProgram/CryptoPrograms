var cipher,uInt8Array,totalWorkers,workerNumber,numSols,keyword1,keyword2,isRunning,keyTrials,gridWd,alphabet,routes,solutions=[];
function decipherTwoSquare(){"function"===typeof importScripts&&(importScripts("../support/decipherLib.js"),importScripts("../support/cryptoPrograms.js"));keyTrials=0;gridWd=5;initSolution();"undefined"!==typeof keyword1&&"undefined"!==typeof keyword2&&(0<keyword1.length?solveWithKeyword(keyword1,keyword2):solveTwoSquare());!1===isRunning&&self.postMessage({cmd:"STOP",msg:""})}
function solveTwoSquare(){var a,c,b,g,e,m=[],n=[];var d=[];var f=[],h=[],p=[],q=[],u=[],t;var l=alphabet.length;isRunning=!0;var v=t=!1;d=randomiseAlphabet(l,alphabet).split("");for(a=0;a<d.length;a+=1)m[a]=d[a];d=randomiseAlphabet(l,alphabet).split("");for(a=0;a<d.length;a+=1)n[a]=d[a];for(b=0;1E4>b;b+=1){if(!v){d=randomiseAlphabet(l,alphabet).split("");for(a=0;a<d.length;a+=1)m[a]=d[a];d=randomiseAlphabet(l,alphabet).split("");for(a=0;a<d.length;a+=1)n[a]=d[a]}for(a=0;a<l;a+=1)p[a]=m[a],q[a]=n[a];
var k=decrypt(p,q);d=e=getTetraScore(k);v=!1;for(c=20;0<=c;c-=.1)for(g=0;1E4>g;g+=1){for(a=0;a<p.length;a+=1)f[a]=p[a],h[a]=q[a];0===g%1E3&&(t=!t);k=Math.floor(50*Math.random());switch(k){case 1:case 2:case 8:if(t){for(a=0;a<l;a+=1)u[a]=f[a];for(a=0;a<l;a+=1)f[a]=u[routes[k][a]]}else{for(a=0;a<l;a+=1)u[a]=h[a];for(a=0;a<l;a+=1)h[a]=u[routes[k][a]]}break;case 3:t?swapCols(f):swapCols(h);break;case 4:t?swapRows(f):swapRows(h);break;default:do k=Math.floor(Math.random()*l),a=Math.floor(Math.random()*
l);while(k===a);if(0===g%2){var r=f[k];f[k]=f[a];f[a]=r}else r=h[k],h[k]=h[a],h[a]=r}k=decrypt(f,h);a=getTetraScore(k);r=a-e;if(0<=r)for(e=a,a=0;a<f.length;a+=1)p[a]=f[a],q[a]=h[a];else if(0<c){r=Math.pow(Math.E,r/c);var w=(1E3*Math.random()+1)/1E3;if(r>w)for(e=a,a=0;a<f.length;a+=1)p[a]=f[a],q[a]=h[a]}if(e>d){d=e;v=!0;for(a=0;a<p.length;a+=1)m[a]=p[a],n[a]=q[a];solutions[numSols-1]<d&&(solutions[numSols-1]=d,solutions.sort(function(x,y){return y-x}),self.postMessage({cmd:"reslt",key:m.join("")+"/"+
n.join("").toLowerCase(),score:d,text:k}))}}}isRunning=!1}function swapRows(a){var c;do{var b=Math.floor(Math.random()*gridWd)*gridWd;var g=Math.floor(Math.random()*gridWd)*gridWd}while(b===g);for(c=0;c<gridWd;c+=1){var e=a[b+c];a[b+c]=a[g+c];a[g+c]=e}}function swapCols(a){var c;do{var b=Math.floor(Math.random()*gridWd);var g=Math.floor(Math.random()*gridWd)}while(b===g);for(c=0;c<gridWd;c+=1){var e=a[c*gridWd+b];a[c*gridWd+b]=a[c*gridWd+g];a[c*gridWd+g]=e}}
function decrypt(a,c){var b;var g=cipher.length;var e="";for(b=0;b<g;b+=2){var m=c.indexOf(cipher[b]);var n=a.indexOf(cipher[b+1]);var d=Math.floor(m/gridWd);var f=Math.floor(n/gridWd);d===f?(e+=cipher[b+1],e+=cipher[b]):(e+=a[d*gridWd+n%gridWd],e+=c[f*gridWd+m%gridWd])}return e.toLowerCase()}
function solveWithKeyword(a,c){var b,g,e;var m=getKeyedAlphabet(alphabet,a);var n=getKeyedAlphabet(alphabet,c);for(g=0;g<routes.length;g+=1){var d="";for(b=0;b<alphabet.length;b+=1)d+=m[routes[g][b]];for(e=0;e<routes.length;e+=1){var f="";for(b=0;b<alphabet.length;b+=1)f+=n[routes[e][b]];var h=decrypt(d,f);b=getTetraScore(h);solutions[numSols-1]<b&&(solutions[numSols-1]=b,solutions.sort(function(p,q){return q-p}),self.postMessage({cmd:"reslt",key:d+"/"+f.toLowerCase(),score:b,text:h}))}}isRunning=
!1}self.addEventListener("message",function(a){a=a.data;cipher=a.cipher;uInt8Array=a.uInt8Array;totalWorkers=a.totalWorkers;workerNumber=a.workerNumber;numSols=a.numSols;keyword1=a.keyword1;keyword2=a.keyword2;alphabet=a.alphabet;routes=a.routes;decipherTwoSquare()},!1);