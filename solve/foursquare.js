var cipher,uInt8Array,totalWorkers,workerNumber,numSols,keyword1,keyword2,isRunning,keyTrials,gridWd,alphabet,routes,solutions=[];
function decipherFourSquare(){"function"===typeof importScripts&&(importScripts("../support/decipherLib.js"),importScripts("../support/cryptoPrograms.js"));keyTrials=0;gridWd=5;initSolution();"undefined"!==typeof keyword1&&"undefined"!==typeof keyword2&&(0<keyword1.length?solveWithKeyword(keyword1,keyword2):solveFourSquare());!1===isRunning&&self.postMessage({cmd:"STOP",msg:""})}
function solveFourSquare(){var a,m,b,f,d,h=[],n=[];var c=[];var e=[],g=[],k=[],p=[];var r=alphabet.length;isRunning=!0;c=randomiseAlphabet(r,alphabet).split("");for(a=0;a<c.length;a+=1)h[a]=c[a];c=randomiseAlphabet(r,alphabet).split("");for(a=0;a<c.length;a+=1)n[a]=c[a];for(b=0;1E4>b;b+=1){for(a=0;a<h.length;a+=1)k[a]=h[a],p[a]=n[a];var l=decrypt(k,p);c=d=getTetraScore(l);for(m=20;0<=m;m-=.1)for(f=0;1E4>f;f+=1){for(a=0;a<k.length;a+=1)e[a]=k[a],g[a]=p[a];do l=Math.floor(Math.random()*r),a=Math.floor(Math.random()*
r);while(l===a);if(0===f%2){var q=e[l];e[l]=e[a];e[a]=q}else q=g[l],g[l]=g[a],g[a]=q;l=decrypt(e,g);a=getTetraScore(l);q=a-d;if(0<=q)for(d=a,a=0;a<e.length;a+=1)k[a]=e[a],p[a]=g[a];else if(0<m){q=Math.pow(Math.E,q/m);var t=(1E3*Math.random()+1)/1E3;if(q>t)for(d=a,a=0;a<e.length;a+=1)k[a]=e[a],p[a]=g[a]}if(d>c){c=d;for(a=0;a<k.length;a+=1)h[a]=k[a],n[a]=p[a];solutions[numSols-1]<c&&(solutions[numSols-1]=c,solutions.sort(function(u,v){return v-u}),self.postMessage({cmd:"reslt",key:h.join("")+"/"+n.join("").toLowerCase(),
score:c,text:l}))}}}isRunning=!1}function decrypt(a,m){var b;var f=cipher.length;var d="";for(b=0;b<f;b+=2){var h=a.indexOf(cipher[b]);var n=m.indexOf(cipher[b+1]);d+=alphabet.substr(Math.floor(h/gridWd)*gridWd+n%gridWd,1);d+=alphabet.substr(Math.floor(n/gridWd)*gridWd+h%gridWd,1)}return d.toLowerCase()}
function solveWithKeyword(a,m){var b,f,d;var h=getKeyedAlphabet(alphabet,a);var n=getKeyedAlphabet(alphabet,m);for(f=0;f<routes.length;f+=1){var c="";for(b=0;b<alphabet.length;b+=1)c+=h[routes[f][b]];for(d=0;d<routes.length;d+=1){var e="";for(b=0;b<alphabet.length;b+=1)e+=n[routes[d][b]];var g=decrypt(c,e);b=getTetraScore(g);solutions[numSols-1]<b&&(solutions[numSols-1]=b,solutions.sort(function(k,p){return p-k}),self.postMessage({cmd:"reslt",key:c+"/"+e.toLowerCase(),score:b,text:g}))}}isRunning=
!1}self.addEventListener("message",function(a){a=a.data;cipher=a.cipher;uInt8Array=a.uInt8Array;totalWorkers=a.totalWorkers;workerNumber=a.workerNumber;numSols=a.numSols;keyword1=a.keyword1;keyword2=a.keyword2;alphabet=a.alphabet;routes=a.routes;decipherFourSquare()},!1);