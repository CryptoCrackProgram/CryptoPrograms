var cipher,uInt8Array,totalWorkers,workerNumber,numSols,keyword,isRunning,keyTrials,alphabet,arrKey=[],solutions=[],offset=[],cipherReduced=[];function decipherRagbaby(){"function"===typeof importScripts&&(importScripts("../support/decipherLib.js"),importScripts("../support/cryptoPrograms.js"));keyTrials=0;arrKey.length=0;initSolution();getOffsets();"undefined"!==typeof keyword&&(0<keyword.length?solveWithKeyword(keyword):solveRagbaby());!1===isRunning&&self.postMessage({cmd:"STOP",msg:""})}
function solveRagbaby(){var a,e,d,f=[];var b=[];var c=[];var g=alphabet.length;var l=0;isRunning=!0;for(e=0;1E3>e;e+=1)if(isRunning){b=randomiseAlphabet(g,alphabet).split("");for(a=0;a<b.length;a+=1)c[a]=b[a],f[a]=b[a];a=decrypt(c.join(""));var m=getTetraScore(a.replace(/[^a-z]/g,""));keyTrials+=1;solutions[numSols-1]<m&&(solutions[numSols-1]=m,solutions.sort(function(p,q){return q-p}),self.postMessage({cmd:"reslt",key:c.join(""),score:m,text:a}));for(d=15;2<d;--d){var n=b=0;do{for(a=0;a<f.length;a+=
1)c[a]=f[a];var h=Math.floor(Math.random()*g);a=Math.floor(Math.random()*g);var k=c[h];c[h]=c[a];c[a]=k;a=decrypt(c.join(""));h=getTetraScore(a.replace(/[^a-z]/g,""));solutions[numSols-1]<h&&(solutions[numSols-1]=h,solutions.sort(function(p,q){return q-p}),self.postMessage({cmd:"reslt",key:c.join(""),score:h,text:a}));h>n&&(n=h,n>l&&(l=n));keyTrials+=1;k=h-m;a=0;if(0<k)a=1;else{k=Math.pow(Math.E,k/d);var r=(1E3*Math.random()+1)/1E3;k>r&&(a=1)}if(1===a){for(a=0;a<c.length;a+=1)f[a]=c[a];m=h}b+=1}while(1E3>
b&&isRunning)}}isRunning=!1}function decrypt(a){var e,d=0;var f=alphabet.length;var b="";var c=new RegExp("["+alphabet+"]","i");for(e=0;e<cipher.length;e+=1){var g=cipher[e];g.match(c)?(g=a.indexOf(g),g=(g-offset[d]+f)%f,b+=a[g],d+=1):b+=cipher[e]}return b.toLowerCase()}
function solveWithKeyword(a){var e=alphabet.length;24===e&&(a=a.replace("J","I"),a=a.replace("X","W"));var d=getKeyedLangAlph(a,alphabet);var f=decrypt(d);var b=getTetraScore(f.replace(/[^a-z]/g,""));solutions[numSols-1]<b&&(solutions[numSols-1]=b,solutions.sort(function(c,g){return g-c}),self.postMessage({cmd:"reslt",key:d,score:b,text:f}));36===e&&(d=getACAKeyedAlphabet(alphabet,a),f=decrypt(d),b=getTetraScore(f.replace(/[^a-z]/g,"")),solutions[numSols-1]<b&&(solutions[numSols-1]=b,solutions.sort(function(c,
g){return g-c}),self.postMessage({cmd:"reslt",key:d,score:b,text:f})));isRunning=!1}function getOffsets(){var a,e=0,d=1,f=1;var b="";var c=alphabet.length;var g=new RegExp("["+alphabet+"]","i");for(a=0;a<cipher.length;a+=1){var l=b;b=cipher[a];b.match(g)?(24===c&&("J"===b&&(b="I"),"X"===b&&(b="W")),cipherReduced[e]=b,offset[e]=d,e+=1,d=(d+1)%c):" "!==b&&13!==b&&"="!==b||" "===l||"="===l||(f+=1,d=f%=c)}}
self.addEventListener("message",function(a){a=a.data;cipher=a.cipher;uInt8Array=a.uInt8Array;totalWorkers=a.totalWorkers;workerNumber=a.workerNumber;numSols=a.numSols;keyword=a.keyword;alphabet=a.alphabet;decipherRagbaby()},!1);