var plain,solutions=[],cipher,keyword,numSols,uInt8Array,workerNumber,totalWorkers,isRunning,cipherLength,alphabetMask=[];function decipherBacon(){"function"===typeof importScripts&&(importScripts("decipherLib.js"),importScripts("cryptoPrograms.js"));initSolution();createMasks();cipherLength=cipher.length;"undefined"!==typeof keyword&&(0<keyword.length?solveWithKeyword():solveBacon());!1===isRunning&&self.postMessage({cmd:"STOP",msg:""})}
function solveBacon(){var a,c=ord("A"),d=ord("Z");var b=Math.floor(67108864/totalWorkers)*workerNumber;var f=Math.floor(67108864/totalWorkers)*(workerNumber+1);b=0;b=1<totalWorkers?workerNumber:0;for(isRunning=!0;b<f;b+=totalWorkers){var e=numberOfSetBits(b);if(6<e&&19>e){if(keyIsValid(b)&&testKey(b)){e=getTetraScore(plain);var g="";for(a=c;a<=d;a+=1)g=0<(b&alphabetMask[a])?g+"B":g+"A";solutions[numSols-1]<e&&(solutions[numSols-1]=e,solutions.sort(function(h,k){return k-h}),self.postMessage({cmd:"reslt",
key:g,score:e,text:plain}))}self.postMessage({cmd:"progress",worker:workerNumber,trials:b,totalWorkers:totalWorkers})}}isRunning=!1}function keyIsValid(a){var c=0;var d=!0;do{var b=cipher.charAt(c);c+=1;var f=cipher.charAt(c);c+=1;0<(a&alphabetMask[b])&&0<(a&alphabetMask[f])&&(d=!1)}while(!0===d&&c<cipherLength);return d}
function testKey(a){var c,d,b,f,e=ord("a"),g=ord("z");plain="";var h=!0;for(c=f=0;c<cipherLength;c+=5){for(d=b=0;5>d;d+=1){var k=ord(cipher.charAt(f));f+=1;b<<=1;0<(a&alphabetMask[k])&&(b+=1)}b=b+e+(8<b)+(19<b);b>g&&(b="?",h=!1);plain+=chr(b)}return h}function numberOfSetBits(a){a-=a>>1&1431655765;a=(a&858993459)+(a>>2&858993459);return 16843009*(a+(a>>4)&252645135)>>24}
function createMasks(){alphabetMask[90]=1;alphabetMask[89]=2;alphabetMask[88]=4;alphabetMask[87]=8;alphabetMask[86]=16;alphabetMask[85]=32;alphabetMask[84]=64;alphabetMask[83]=128;alphabetMask[82]=256;alphabetMask[81]=512;alphabetMask[80]=1024;alphabetMask[79]=2048;alphabetMask[78]=4096;alphabetMask[77]=8192;alphabetMask[76]=16384;alphabetMask[75]=32768;alphabetMask[74]=65536;alphabetMask[73]=131072;alphabetMask[72]=262144;alphabetMask[71]=524288;alphabetMask[70]=1048576;alphabetMask[69]=2097152;
alphabetMask[68]=4194304;alphabetMask[67]=8388608;alphabetMask[66]=16777216;alphabetMask[65]=33554432}function solveWithKeyword(){var a=keyword.replace(/[A]/gi,"0");a=a.replace(/[B]/gi,"1");a=parseInt(a,2);keyIsValid(a)?testKey(a)&&(a=getTetraScore(plain),self.postMessage({cmd:"reslt",key:keyword,score:a,text:plain.toLowerCase()})):self.postMessage({cmd:"reslt",key:"",score:0,text:"Key not valid!"});isRunning=!1}
self.addEventListener("message",function(a){a=a.data;cipher=a.cipher;uInt8Array=a.uInt8Array;totalWorkers=a.totalWorkers;workerNumber=a.workerNumber;numSols=a.numSols;keyword=a.keyword;decipherBacon()},!1);